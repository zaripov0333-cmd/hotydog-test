<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hoty Dogy Dashboard</title>

<style>
body{
margin:0;
font-family:Arial;
background:#f5c542;
}

header{
background:black;
color:white;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

button{
padding:8px 15px;
border:none;
border-radius:6px;
cursor:pointer;
margin:5px;
}

.adminBtn{background:#000;color:white;}
.viewerBtn{background:#555;color:white;}
.good{background:green;color:white;}
.bad{background:red;color:white;}

.container{
padding:20px;
}

.card{
background:white;
padding:15px;
margin-bottom:10px;
border-radius:10px;
}

.hidden{display:none;}
</style>
</head>
<body>

<header>
<div>Hoty Dogy Panel</div>
<button onclick="logout()">Chiqish</button>
</header>

<div class="container">

<select id="monthSelect"></select>
<button onclick="addMonth()">Yangi Oy</button>

<div id="menu"></div>
<div id="content"></div>

</div>

<script>

/* ROLE */
const role = sessionStorage.getItem("roleToken");
if(!role) window.location="index.html";

/* FILIALS */
const branches = ["Ц1","Шевченко","Чилонзор","Нехт","Эко","ИТ парк"];
const questions = [

{ text:"Restoran oldidagi bruschatka butun, mustahkam va toza.", minus:1 },
{ text:"XotyDogy yorlig'i toza va soz.", minus:1 },
{ text:"Chiqindi baklari toza va 3/4 dan oshmagan.", minus:1 },
{ text:"Zina va pandus toza va shikastlanmagan.", minus:1 },
{ text:"Kirish guruhlari texnik soz.", minus:1 },
{ text:"Vitrajli derazalar toza.", minus:1 },
{ text:"Dekor devorlarga mahkam yopishtirilgan.", minus:2 },
{ text:"Barcha yoritish vositalari ishlaydi.", minus:1 },
{ text:"Eshik oldidagi gilam toza.", minus:1 },
{ text:"Stollar toza va salfetnitsa mavjud.", minus:2 },
{ text:"Zal atmosferasi yaxshi.", minus:1 },
{ text:"Zov-klient ishlaydi.", minus:1 },
{ text:"Axlat idishlari toza.", minus:1 },
{ text:"Devorlar eskirmagan.", minus:1 },
{ text:"Pollar toza.", minus:1 },
{ text:"Bolalar o‘rindig‘i toza.", minus:2 },
{ text:"Banner butun.", minus:1 },
{ text:"Menu aktual.", minus:1 },
{ text:"TV Board aktual.", minus:1 },
{ text:"Flayerlar mavjud.", minus:2 },
{ text:"Xolodilnik toza va +6°.", minus:2 },
{ text:"Kassa zonasi standartga mos.", minus:2 },
{ text:"Buyurtma yig‘ish zonasi standart.", minus:2 },
{ text:"Buyurtma aniqligi.", minus:2 },
{ text:"Polda saqlash yo‘q.", minus:1 },
{ text:"Kassada FIFO.", minus:1 },
{ text:"Ikkinchi darajali qadoq kassada yo‘q.", minus:1 },
{ text:"Kassada shaxsiy narsalar yo‘q.", minus:2 },
{ text:"Stop-list mavjud.", minus:2 },
{ text:"Podnos va tarelkalar toza.", minus:2 },
{ text:"TV va boardlar changsiz.", minus:1 },
{ text:"Postmix apparati toza.", minus:1 },
{ text:"Chiqindi chelagi toza.", minus:1 },
{ text:"Oshxona pollari toza.", minus:1 },
{ text:"Oshxona harorati ≤26°.", minus:2 },
{ text:"Mahsulotlar FIFO asosida.", minus:1 },
{ text:"Meklayn toza.", minus:1 },
{ text:"Meklayn harorati ≤+6°.", minus:1 },
{ text:"Ikkinchi qadoq oshxonada yo‘q.", minus:1 },
{ text:"Toster, frityur toza.", minus:2 },
{ text:"Zagatovka stoli toza.", minus:1 },
{ text:"Mahsulot saqlash standart.", minus:2 },
{ text:"Osma javonlar toza.", minus:1 },
{ text:"Hisobdan chiqarish o‘z vaqtida.", minus:5 },
{ text:"Sabzavot rakovina toza.", minus:1 },
{ text:"Tarozilar toza.", minus:2 },
{ text:"FIFO gastronom idishlar.", minus:2 },
{ text:"Mahsulot harorati ≤+6°.", minus:2 },
{ text:"Ombor stelajlari toza.", minus:1 },
{ text:"Eshiklar soz.", minus:1 },
{ text:"Tovar qo‘shnichiligi saqlangan.", minus:2 },
{ text:"Muzlatkich harorati -10°/-18°.", minus:2 },
{ text:"Polda hech narsa saqlanmaydi.", minus:1 },
{ text:"Sanitariya qo‘pol buzilishi yo‘q.", minus:2 },
{ text:"Restoran tayyorligi.", minus:2 },
{ text:"Xodimlar qo‘l yuvish qoidasi.", minus:5 },
{ text:"Simlar chiqmagan.", minus:2 },
{ text:"Xodim shaxsiy fayli mavjud.", minus:2 },
{ text:"Telefonlar topshirilgan.", minus:2 },
{ text:"Xodim tashqi ko‘rinishi standart.", minus:2 },
{ text:"Ognetushitel yashil zona.", minus:1 },
{ text:"Razdevalka tartibli.", minus:2 },
{ text:"Restoranda yoriq yo‘q.", minus:1 },
{ text:"Latta matolar to‘g‘ri saqlanadi.", minus:2 },
{ text:"Inventar toza.", minus:5 },
{ text:"Zararkunanda yo‘q.", minus:5 },
{ text:"Qo‘l yuvish sovuni bor.", minus:5 },
{ text:"Formasiz yurish yo‘q.", minus:5 },
{ text:"Mahsulot sifati yaxshi.", minus:5 },
{ text:"Yaroqlilik muddati o‘tmagan.", minus:20 },
{ text:"Markirovka ustidan markirovka yo‘q.", minus:20 },
{ text:"Markirovka mavjud.", minus:20 },
{ text:"Smena mas'ul shaxs mavjud.", minus:20 }

];
/* DATA */
function getData(){
return JSON.parse(localStorage.getItem("auditData")||"{}");
}

function saveData(d){
localStorage.setItem("auditData",JSON.stringify(d));
}

/* MONTH */
function addMonth(){
if(role!=="superadmin") return;

let name=prompt("Oy nomi (2026-03):");
if(!name) return;

let data=getData();
if(!data[name]) data[name]={};
saveData(data);
loadMonths();
}

function loadMonths(){
let data=getData();
let select=document.getElementById("monthSelect");
select.innerHTML="";
Object.keys(data).forEach(m=>{
select.innerHTML+=`<option>${m}</option>`;
});
}

loadMonths();

/* MENU */
function loadMenu(){
let menu=document.getElementById("menu");
menu.innerHTML="";
branches.forEach(b=>{
menu.innerHTML+=`<button onclick="openBranch('${b}')">${b}</button>`;
});
menu.innerHTML+=`<button onclick="showAuditBall()">Audit Ball</button>`;
}

loadMenu();

/* OPEN BRANCH */
let currentBranch="";
let currentAudit=0;

function openBranch(branch){
currentBranch=branch;
let c=document.getElementById("content");
c.innerHTML=`
<h3>${branch}</h3>
<button onclick="startAudit(0)">Audit 1</button>
<button onclick="startAudit(1)">Audit 2</button>
`;
}

/* START AUDIT */
let tempMarks={};

function startAudit(index){
if(role!=="superadmin") return;

currentAudit=index;
tempMarks={};

let html="<h3>Audit</h3>";

questions.forEach((q,i)=>{
html+=`
<div class="card">
<p>${q.text}</p>
<button class="good" onclick="mark(${i},'good')">✔</button>
<button class="bad" onclick="mark(${i},'bad')">✖</button>
<input type="file" onchange="uploadImage(event,${i})">
</div>
`;
});

html+=`<button onclick="finishAudit()">Yakunlash</button>`;
document.getElementById("content").innerHTML=html;
}

function mark(i,type){
tempMarks[i]=type;
}

function uploadImage(e,i){
let reader=new FileReader();
reader.onload=function(){
tempMarks["img_"+i]=reader.result;
}
reader.readAsDataURL(e.target.files[0]);
}

/* FINISH */
function finishAudit(){

let score=100;

Object.keys(tempMarks).forEach(k=>{
if(!k.includes("img_")){
if(tempMarks[k]==="bad"){
score-=questions[k].minus;
}
}
});

let month=document.getElementById("monthSelect").value;
let data=getData();

if(!data[month][currentBranch]){
data[month][currentBranch]={audits:[null,null]};
}

data[month][currentBranch].audits[currentAudit]=score;

saveData(data);

alert("Saqlandi");
openBranch(currentBranch);
}

/* AUDIT BALL */
function showAuditBall(){
let month=document.getElementById("monthSelect").value;
let data=getData();
let html="<h3>Audit Ball</h3>";

branches.forEach(b=>{
let avg=0;
if(data[month] && data[month][b]){
let a=data[month][b].audits;
let sum=0,count=0;
a.forEach(x=>{
if(x!=null){sum+=x;count++;}
});
if(count>0) avg=(sum/count).toFixed(1);
}
html+=`<div class="card">${b} : ${avg}</div>`;
});

document.getElementById("content").innerHTML=html;
}

/* LOGOUT */
function logout(){
sessionStorage.removeItem("roleToken");
window.location="index.html";
}

</script>
</body>
</html>
