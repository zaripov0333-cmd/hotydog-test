<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hoty Dogy Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background:#FFD43B;
  overflow-x:hidden;
}

.header{
  background:#FFB800;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:bold;
  font-size:18px;
}

.container{
  padding:15px;
}

.card{
  background:white;
  padding:15px;
  border-radius:15px;
  margin-bottom:15px;
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
}

.menu-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.menu-btn{
  padding:15px;
  background:#fff;
  border-radius:15px;
  text-align:center;
  font-weight:bold;
  box-shadow:0 5px 15px rgba(0,0,0,0.15);
  cursor:pointer;
  transition:0.2s;
}

.menu-btn:hover{
  transform:scale(1.05);
}

.back-btn{
  margin-bottom:10px;
  display:inline-block;
  padding:8px 12px;
  background:#FFB800;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}

input,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid #ccc;
}

img{
  width:100%;
  border-radius:10px;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="header">
  Hoty Dogy Admin
  <div onclick="logout()" style="cursor:pointer;">Chiqish</div>
</div>

<div class="container" id="mainMenu">

  <div class="menu-grid">
    <div class="menu-btn" onclick="openAudit()">–ê—É–¥–∏—Ç</div>
    <div class="menu-btn" onclick="openAuditBall()">–ê—É–¥–∏—Ç –ë–∞–ª–ª</div>
    <div class="menu-btn" onclick="openSBBall()">–°–ë –ë–∞–ª–ª</div>
    <div class="menu-btn" onclick="openUsers()">Foydalanuvchilar</div>
  </div>

</div>

<div class="container" id="content" style="display:none;"></div>

<script>

const branches = ["–¶1","–®–µ–≤—á–µ–Ω–∫–æ","–ß–∏–ª–æ–Ω–∑–æ—Ä","–ù–µ—Ö—Ç","–≠–∫–æ","–ò–¢ –ø–∞—Ä–∫"];
const role = localStorage.getItem("role");

if(!role){
  window.location="/index.html";
}

function logout(){
  localStorage.clear();
  window.location="/index.html";
}

function showMenu(){
  content.style.display="none";
  mainMenu.style.display="block";
}

function openAudit(){
  mainMenu.style.display="none";
  content.style.display="block";

  let html = `<div class="back-btn" onclick="showMenu()">‚¨Ö Orqaga</div>`;
  branches.forEach(b=>{
    html += `
      <div class="card">
        <h3>${b}</h3>
        <input type="file" onchange="saveAudit(event,'${b}')">
        <div id="list-${b}"></div>
      </div>
    `;
  });

  content.innerHTML = html;
  branches.forEach(b=>loadAudit(b));
}

function saveAudit(event, branch){
  const file = event.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(e){
    const data = JSON.parse(localStorage.getItem("auditData") || "{}");
    if(!data[branch]) data[branch] = [];

    data[branch].push({
      image: e.target.result,
      date: new Date().toLocaleString()
    });

    localStorage.setItem("auditData", JSON.stringify(data));
    loadAudit(branch);
  };
  reader.readAsDataURL(file);
}

function loadAudit(branch){
  const data = JSON.parse(localStorage.getItem("auditData") || "{}");
  const container = document.getElementById(`list-${branch}`);
  if(!container) return;

  container.innerHTML = "";
  if(data[branch]){
    data[branch].forEach(item=>{
      container.innerHTML += `
        <div class="card">
          üìÖ ${item.date}
          <img src="${item.image}">
        </div>
      `;
    });
  }
}

function openAuditBall(){
  openBall("audit");
}

function openSBBall(){
  openBall("sb");
}

function openBall(type){
  mainMenu.style.display="none";
  content.style.display="block";

  let html = `<div class="back-btn" onclick="showMenu()">‚¨Ö Orqaga</div>`;

  branches.forEach(b=>{
    html += `
      <div class="card">
        <h3>${b}</h3>
        <input ${role !== "admin" ? "disabled" : ""} 
        value="${getScore(type,b)||""}"
        onchange="saveScore('${type}','${b}',this.value)">
      </div>
    `;
  });

  content.innerHTML = html;
}

function saveScore(type, branch, value){
  if(role !== "admin") return;

  const scores = JSON.parse(localStorage.getItem("scores") || "{}");
  if(!scores[type]) scores[type] = {};
  scores[type][branch] = value;

  localStorage.setItem("scores", JSON.stringify(scores));
}

function getScore(type, branch){
  const scores = JSON.parse(localStorage.getItem("scores") || "{}");
  return scores[type]?.[branch];
}

function openUsers(){
  if(role !== "admin"){
    alert("Faqat admin");
    return;
  }

  mainMenu.style.display="none";
  content.style.display="block";

  content.innerHTML = `
    <div class="back-btn" onclick="showMenu()">‚¨Ö Orqaga</div>
    <div class="card">
      <h3>Yangi foydalanuvchi</h3>
      <input id="newLogin" placeholder="Login">
      <input id="newPassword" placeholder="Parol">
      <select id="newRole">
        <option value="viewer">Viewer</option>
        <option value="editor">Editor</option>
        <option value="admin">Admin</option>
      </select>
      <button onclick="createUser()">Qo‚Äòshish</button>
    </div>
  `;
}

function createUser(){
  fetch("/api/login",{
    method:"PUT",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      login: document.getElementById("newLogin").value,
      password: document.getElementById("newPassword").value,
      role: document.getElementById("newRole").value
    })
  })
  .then(res=>res.json())
  .then(data=>alert(data.message));
}

</script>

</body>
</html>
