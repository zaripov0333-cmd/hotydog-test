<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hoty Dogy Audit</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI;}
body{background:#FFD43B;}
.header{
background:black;color:#FFD43B;
padding:15px;display:flex;
justify-content:space-between;
font-weight:bold;
}
.container{padding:15px;}
.menu{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.btn{
background:white;padding:15px;
border-radius:15px;text-align:center;
font-weight:bold;cursor:pointer;
box-shadow:0 5px 20px rgba(0,0,0,0.2);
}
.card{
background:white;padding:15px;
border-radius:15px;margin-bottom:10px;
}
.back{
background:black;color:#FFD43B;
padding:6px 10px;border-radius:15px;
display:inline-block;margin-bottom:10px;
cursor:pointer;
}
button{
margin:3px;padding:6px 10px;
border:none;border-radius:6px;
background:black;color:#FFD43B;
cursor:pointer;
}
select,input{
width:100%;padding:8px;
margin:5px 0;border-radius:8px;
}
img{margin-top:5px;border-radius:8px;}
.good{background:green!important;}
.bad{background:red!important;}
</style>
</head>

<body>

<div class="header">
Hoty Dogy Audit System
<div onclick="logout()">Chiqish</div>
</div>

<div class="container">

<select id="monthSelect" onchange="changeMonth()"></select>

<div id="menu" class="menu"></div>
<div id="content"></div>

</div>

<script>

/* ROLE */
const role=localStorage.getItem("role");
if(!role) window.location="index.html";

/* FILIALS */
const branches = ["Ц1","Шевченко","Чилонзор","Нехт","Эко","ИТ парк"];
const questions = [

{ text:"Restoran oldidagi bruschatka butun, mustahkam va toza.", minus:1 },
{ text:"XotyDogy yorlig'i toza va soz.", minus:1 },
{ text:"Chiqindi baklari toza va 3/4 dan oshmagan.", minus:1 },
{ text:"Zina va pandus toza va shikastlanmagan.", minus:1 },
{ text:"Kirish guruhlari texnik soz.", minus:1 },
{ text:"Vitrajli derazalar toza.", minus:1 },
{ text:"Dekor devorlarga mahkam yopishtirilgan.", minus:2 },
{ text:"Barcha yoritish vositalari ishlaydi.", minus:1 },
{ text:"Eshik oldidagi gilam toza.", minus:1 },
{ text:"Stollar toza va salfetnitsa mavjud.", minus:2 },
{ text:"Zal atmosferasi yaxshi.", minus:1 },
{ text:"Zov-klient ishlaydi.", minus:1 },
{ text:"Axlat idishlari toza.", minus:1 },
{ text:"Devorlar eskirmagan.", minus:1 },
{ text:"Pollar toza.", minus:1 },
{ text:"Bolalar o‘rindig‘i toza.", minus:2 },
{ text:"Banner butun.", minus:1 },
{ text:"Menu aktual.", minus:1 },
{ text:"TV Board aktual.", minus:1 },
{ text:"Flayerlar mavjud.", minus:2 },
{ text:"Xolodilnik toza va +6°.", minus:2 },
{ text:"Kassa zonasi standartga mos.", minus:2 },
{ text:"Buyurtma yig‘ish zonasi standart.", minus:2 },
{ text:"Buyurtma aniqligi.", minus:2 },
{ text:"Polda saqlash yo‘q.", minus:1 },
{ text:"Kassada FIFO.", minus:1 },
{ text:"Ikkinchi darajali qadoq kassada yo‘q.", minus:1 },
{ text:"Kassada shaxsiy narsalar yo‘q.", minus:2 },
{ text:"Stop-list mavjud.", minus:2 },
{ text:"Podnos va tarelkalar toza.", minus:2 },
{ text:"TV va boardlar changsiz.", minus:1 },
{ text:"Postmix apparati toza.", minus:1 },
{ text:"Chiqindi chelagi toza.", minus:1 },
{ text:"Oshxona pollari toza.", minus:1 },
{ text:"Oshxona harorati ≤26°.", minus:2 },
{ text:"Mahsulotlar FIFO asosida.", minus:1 },
{ text:"Meklayn toza.", minus:1 },
{ text:"Meklayn harorati ≤+6°.", minus:1 },
{ text:"Ikkinchi qadoq oshxonada yo‘q.", minus:1 },
{ text:"Toster, frityur toza.", minus:2 },
{ text:"Zagatovka stoli toza.", minus:1 },
{ text:"Mahsulot saqlash standart.", minus:2 },
{ text:"Osma javonlar toza.", minus:1 },
{ text:"Hisobdan chiqarish o‘z vaqtida.", minus:5 },
{ text:"Sabzavot rakovina toza.", minus:1 },
{ text:"Tarozilar toza.", minus:2 },
{ text:"Gastronom idishlar toza .", minus:2 },
{ text:"Mahsulot harorati ≤+6°.", minus:2 },
{ text:"Ombor stelajlari toza.", minus:1 },
{ text:"Eshiklar soz.", minus:1 },
{ text:"Tovar qo‘shnichiligi saqlangan.", minus:2 },
{ text:"Muzlatkich harorati -10°/-18°.", minus:2 },
{ text:"Polda hech narsa saqlanmaydi.", minus:1 },
{ text:"Sanitariya qo‘pol buzilishi yo‘q.", minus:2 },
{ text:"Restoran tayyorligi.", minus:2 },
{ text:"Xodimlar qo‘l yuvish qoidasi.", minus:5 },
{ text:"Simlar chiqmagan.", minus:2 },
{ text:"Xodim shaxsiy fayli mavjud.", minus:2 },
{ text:"Telefonlar topshirilgan.", minus:2 },
{ text:"Xodim tashqi ko‘rinishi standart.", minus:2 },
{ text:"Ognetushitel yashil zona.", minus:1 },
{ text:"Razdevalka tartibli.", minus:2 },
{ text:"Restoranda yoriq yo‘q.", minus:1 },
{ text:"Latta matolar to‘g‘ri saqlanadi.", minus:2 },
{ text:"Inventar toza.", minus:5 },
{ text:"Zararkunanda yo‘q.", minus:5 },
{ text:"Qo‘l yuvish sovuni bor.", minus:5 },
{ text:"Formasiz yurish yo‘q.", minus:5 },
{ text:"Mahsulot sifati yaxshi.", minus:5 },
{ text:"Yaroqlilik muddati o‘tmagan.", minus:20 },
{ text:"Markirovka ustidan markirovka yo‘q.", minus:20 },
{ text:"Markirovka mavjud.", minus:20 },
{ text:"Smena mas'ul shaxs mavjud.", minus:20 }

];

/* STORAGE */
function getData(){ return JSON.parse(localStorage.getItem("auditData")||"{}"); }
function saveData(d){ localStorage.setItem("auditData",JSON.stringify(d)); }

/* MONTH */
function getMonth(){
let d=new Date();
return d.getFullYear()+"-"+(d.getMonth()+1);
}

let currentMonth=getMonth();

function loadMonths(){
let data=getData();
if(!data[currentMonth]){
data[currentMonth]={};
saveData(data);
}
let select=document.getElementById("monthSelect");
select.innerHTML="";
Object.keys(data).forEach(m=>{
select.innerHTML+=`<option value="${m}">${m}</option>`;
});
select.value=currentMonth;
}

function changeMonth(){
currentMonth=document.getElementById("monthSelect").value;
}

function addMonth(){
if(role!=="superadmin") return;
let name=prompt("Yangi oy (2025-4)");
if(!name) return;
let data=getData();
if(!data[name]) data[name]={};
saveData(data);
currentMonth=name;
loadMonths();
}

/* MENU */
function loadMenu(){
let m=document.getElementById("menu");
m.innerHTML="";
m.innerHTML+=`<div class="btn" onclick="openAudit()">Аудит</div>`;
m.innerHTML+=`<div class="btn" onclick="openAuditBall()">Аудит Балл</div>`;
if(role==="superadmin"){
m.innerHTML+=`<div class="btn" onclick="addMonth()">+ Oy</div>`;
}
}

/* AUDIT */
let currentBranch="";
let currentIndex=0;
let tempMarks={};
let tempImages={};

function openAudit(){
document.getElementById("menu").style.display="none";
let html=`<div class="back" onclick="back()">Orqaga</div>`;
branches.forEach(b=>{
html+=`
<div class="card">
<b>${b}</b><br>
<button onclick="startAudit('${b}',0)">Audit 1</button>
<button onclick="startAudit('${b}',1)">Audit 2</button>
</div>`;
});
document.getElementById("content").innerHTML=html;
}

function startAudit(branch,index){

currentBranch=branch;
currentIndex=index;

let data=getData();
let existing=data[currentMonth]?.[branch]?.audits?.[index];

tempMarks={};
tempImages={};

let html=`<div class="back" onclick="openAudit()">Orqaga</div>`;
html+=`<div class="card"><b>${branch} - Audit ${index+1}</b></div>`;

questions.forEach((q,i)=>{

let savedMark=existing?.marks?.[i];
let savedImage=existing?.images?.[i];

html+=`<div class="card"><p>${q.text}</p>`;

if(role!=="viewer"){
html+=`
<button id="g${i}" onclick="mark(${i},'good')">✔</button>
<button id="b${i}" onclick="mark(${i},'bad')">✖</button>
<input type="file" accept="image/*" onchange="uploadImage(event,${i})">
`;
}

if(savedMark){
html+=`<div style="color:${savedMark==="good"?"green":"red"}">
${savedMark==="good"?"✔ Yaxshi":"❌ Yomon"}
</div>`;
}

if(savedImage){
html+=`<img src="${savedImage}" width="100%">`;
}

html+=`</div>`;
});

if(role!=="viewer"){
html+=`<button onclick="finishAudit()">Tugatish</button>`;
}

document.getElementById("content").innerHTML=html;
}

function mark(i,type){
tempMarks[i]=type;
if(type==="good"){
document.getElementById("g"+i).classList.add("good");
document.getElementById("b"+i).classList.remove("bad");
}else{
document.getElementById("b"+i).classList.add("bad");
document.getElementById("g"+i).classList.remove("good");
}
}

function uploadImage(event,index){
let file=event.target.files[0];
if(!file) return;
let reader=new FileReader();
reader.onload=function(e){
tempImages[index]=e.target.result;
};
reader.readAsDataURL(file);
}

function finishAudit(){

let score=100;
questions.forEach((q,i)=>{
if(tempMarks[i]==="bad") score-=q.minus;
});

let data=getData();
if(!data[currentMonth]) data[currentMonth]={};
if(!data[currentMonth][currentBranch])
data[currentMonth][currentBranch]={audits:[null,null]};

data[currentMonth][currentBranch].audits[currentIndex]={
score:score,
marks:tempMarks,
images:tempImages
};

saveData(data);

alert("Audit saqlandi ✅ Ball: "+score);
openAudit();
}

/* AUDIT BALL */
function openAuditBall(){
document.getElementById("menu").style.display="none";
let data=getData();
let html=`<div class="back" onclick="back()">Orqaga</div>`;

branches.forEach(b=>{
let audits=data[currentMonth]?.[b]?.audits||[null,null];
let avg=0;
if(audits[0]&&audits[1])
avg=(audits[0].score+audits[1].score)/2;
else if(audits[0])
avg=audits[0].score;
else if(audits[1])
avg=audits[1].score;

html+=`<div class="card"><b>${b}</b> : ${avg}</div>`;
});

document.getElementById("content").innerHTML=html;
}

/* GENERAL */
function back(){
document.getElementById("content").innerHTML="";
document.getElementById("menu").style.display="grid";
}

function logout(){
localStorage.removeItem("role");
window.location="index.html";
}

loadMonths();
loadMenu();

</script>
</body>
</html>
